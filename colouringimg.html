<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Coloring Book Tool</title>
    <style>
        /* General Styles */
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 600px;
            width: 100%;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: fadeIn 1s ease-in-out;
        }

        h1 {
            color: #ff6f61;
            font-size: 2.5rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* File Input Styling */
        .file-upload {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload label {
            padding: 15px 30px;
            background: #007BFF;
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background 0.3s ease;
        }

        .file-upload label:hover {
            background: #0056b3;
        }

        /* Button Styling */
        button {
            padding: 15px 30px;
            background: #ff6f61;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #ff4a3d;
        }

        /* Output Section */
        #output {
            margin-top: 30px;
            display: none; /* Hidden until image is processed */
            animation: slideUp 0.5s ease-in-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #outputImage {
            max-width: 100%;
            border: 5px solid #ff6f61;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        #downloadLink {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border-radius: 50px;
            text-decoration: none;
            font-size: 1.1rem;
            transition: background 0.3s ease;
        }

        #downloadLink:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Kids Coloring Book Tool üñçÔ∏è</h1>
        <div class="file-upload">
            <input type="file" id="imageUpload" accept="image/*">
            <label for="imageUpload">Upload Image</label>
        </div>
        <button id="convertBtn">Convert to Outline</button>
        <div id="output">
            <img id="outputImage" src="" alt="Outline Image">
            <a id="downloadLink" href="#" download="outline.png">Download Outline</a>
        </div>
    </div>

    <script>
        document.getElementById('convertBtn').addEventListener('click', function () {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function () {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);

                        // Convert to grayscale
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;
                        for (let i = 0; i < data.length; i += 4) {
                            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                            data[i] = avg; // Red
                            data[i + 1] = avg; // Green
                            data[i + 2] = avg; // Blue
                        }
                        ctx.putImageData(imageData, 0, 0);

                        // Apply Sobel edge detection
                        const sobelData = sobel(canvas);

                        // Draw the Sobel edges onto the canvas
                        const outputData = ctx.createImageData(canvas.width, canvas.height);
                        for (let i = 0; i < sobelData.length; i++) {
                            outputData.data[i * 4] = 255 - sobelData[i]; // Red
                            outputData.data[i * 4 + 1] = 255 - sobelData[i]; // Green
                            outputData.data[i * 4 + 2] = 255 - sobelData[i]; // Blue
                            outputData.data[i * 4 + 3] = 255; // Alpha
                        }
                        ctx.putImageData(outputData, 0, 0);

                        // Display the result
                        const outputImage = document.getElementById('outputImage');
                        outputImage.src = canvas.toDataURL();
                        document.getElementById('output').style.display = 'block';

                        // Enable download link
                        const downloadLink = document.getElementById('downloadLink');
                        downloadLink.href = canvas.toDataURL();
                    };
                };
                reader.readAsDataURL(file);
            } else {
                alert('Please upload an image first!');
            }
        });

        // Sobel edge detection function
        function sobel(canvas) {
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const width = canvas.width;
            const height = canvas.height;
            const sobelData = new Uint8Array(width * height);

            const kernelX = [
                [-1, 0, 1],
                [-2, 0, 2],
                [-1, 0, 1]
            ];
            const kernelY = [
                [-1, -2, -1],
                [0, 0, 0],
                [1, 2, 1]
            ];

            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    let sumX = 0, sumY = 0;
                    for (let ky = -1; ky <= 1; ky++) {
                        for (let kx = -1; kx <= 1; kx++) {
                            const pixel = data[((y + ky) * width + (x + kx)) * 4];
                            sumX += pixel * kernelX[ky + 1][kx + 1];
                            sumY += pixel * kernelY[ky + 1][kx + 1];
                        }
                    }
                    const magnitude = Math.sqrt(sumX * sumX + sumY * sumY);
                    sobelData[y * width + x] = magnitude > 128 ? 255 : 0;
                }
            }
            return sobelData;
        }
    </script>
</body>
</html>
